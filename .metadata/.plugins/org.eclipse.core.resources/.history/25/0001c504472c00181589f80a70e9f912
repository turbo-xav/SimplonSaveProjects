package Model;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.util.MissingResourceException;
import java.util.ResourceBundle;

public abstract class SqlQuery {
	
	private static Connection connection= null;
	
	public static Connection getConnection() {		
		
		
		if(SqlQuery.connection != null) { return SqlQuery.connection; }
		
		System.out.println("-------- PostgreSQL JDBC Connection Test ------------");
		
		try {
			
			ResourceBundle rs 	=	ResourceBundle.getBundle("config");
			String driver 		=	rs.getString("sgbd.driver");
			String dsn 			=	rs.getString("sgbd.dsn");
			String login 		=	rs.getString("sgbd.login");
			String password 	=	rs.getString("sgbd.password");
			
			try {
				
					Class.forName(driver);					
	
					try {
						SqlQuery.connection = DriverManager.getConnection(dsn, login, password);
					} catch (SQLException e) {
	
						System.err.println("Pb de connection");
						e.printStackTrace();
						return null;
	
					}
	
					if (SqlQuery.connection != null) {
						System.out.println("Accès à la base de données ouvert");
						return SqlQuery.connection;
					} else {
						System.err.println("Aucune connexion à la base de données");
					}
					return SqlQuery.connection;			
				
				
				} catch (ClassNotFoundException e) {
					System.out.println("Le driver PosqtGreSQL est introuvable");
					e.printStackTrace();
					return null;
				}	
						
			}
			catch(MissingResourceException e) {
			  System.out.println("il faut vérifier le chemin du fichier properties, il est introuvable");		 
			}		
		

		return null;		
	}
}
